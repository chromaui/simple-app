var __awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r["throw"](t))}catch(t){o(t)}}function u(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})};var __generator=this&&this.__generator||function(t,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return u([t,e])}}function u(s){if(r)throw new TypeError("Generator is already executing.");while(i)try{if(r=1,n&&(o=s[0]&2?n["return"]:s[0]?n["throw"]||((o=n["return"])&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;if(n=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:i.label++;return{value:s[1],done:false};case 5:i.label++;n=s[1];s=[0];continue;case 7:s=i.ops.pop();i.trys.pop();continue;default:if(!(o=i.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){i=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(s[0]===6&&i.label<o[1]){i.label=o[1];o=s;break}if(o&&i.label<o[2]){i.label=o[2];i.ops.push(s);break}if(o[2])i.ops.pop();i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t];n=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};System.register(["./p-d99b9c19.system.js","./p-76deb591.system.js","./p-40fcf55a.system.js","./p-fd4afab3.system.js","./p-e3fa184f.system.js","./p-90888482.system.js","./p-350cb6c0.system.js"],function(t){"use strict";var e,i,r,n,o,s,a,u,c,l,d,f,p,h;return{setters:[function(t){e=t.r;i=t.c;r=t.h;n=t.g},function(t){o=t.d5;s=t.B;a=t.t;u=t.u;c=t.W;l=t.fZ;d=t.fX;f=t.dj;p=t.al},function(){},function(){},function(){},function(t){h=t.dd},function(){}],execute:function(){var y=t("yoo_form_catalog",function(){function t(t){e(this,t);this.validators=[];this.isHistory=false;this.validityChanged=i(this,"validityChanged",7);this.inputBlurred=i(this,"inputBlurred",7);this.inputFocused=i(this,"inputFocused",7);this.inputChanged=i(this,"inputChanged",7);this.fetchData=i(this,"fetchData",7);this.fetchFieldFilterData=i(this,"fetchFieldFilterData",7)}t.prototype.updateValues=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.formAutocomplete){this.formAutocomplete.updateValues(t)}return[2]})})};t.prototype.componentWillLoad=function(){o(this)};t.prototype.onSelect=function(t){t.stopPropagation();if(t.detail){if(this.isCheck){this.setValue(t.detail)}else{this.addProducts(t.detail)}}};Object.defineProperty(t.prototype,"selectedProducts",{get:function(){var t=this;if(this.isCheck){return[].concat(this.value)}else{var e=[];var i=this.getProductRefs();i.forEach(function(i){t.products.forEach(function(r){if(r._id===i&&t.value[i]>0){e.push(r)}})});return e}},enumerable:true,configurable:true});t.prototype.onFetchData=function(t){t.stopPropagation();this.fetchData.emit(t.detail)};t.prototype.onFetchFieldFilterData=function(t){t.stopPropagation();if(this.catalog&&t.detail&&t.detail.field){t.detail.field.filters=[[{field:"catalogRef",operator:{_id:"eq"},value:this.catalog}]]}this.fetchFieldFilterData.emit(t.detail)};t.prototype.onScanned=function(t){t.stopPropagation();this.notFoundError="";var e=t.detail;if(e){var i=s(this.products,function(t){return t.reference===e});if(i&&i.length>0){var r=i[0];if(this.isCheck){this.setValue(r)}this.addProducts([r])}else{this.notFoundError=e+" "+a("NOTFOUND")}}};t.prototype.onInputBlurred=function(t){t.stopPropagation();this.inputBlurred.emit(t.detail)};t.prototype.onInputFocused=function(t){t.stopPropagation();this.inputFocused.emit(t.detail)};t.prototype.addProducts=function(t){var e=this;if(t&&t.length>0){t.forEach(function(t){return e.addProduct(t)})}};t.prototype.setProduct=function(t,e){if(e===0||!u(e)||e<0){return}if(t.outofstock){return}var i=this.value||{};if(!c(this.value)){this.value={}}i[t._id]=i[t._id]||0;if(this.isPresence){i[t._id]=1}else{i[t._id]=e>0?e:0}if(this.products&&this.products.findIndex(function(e){return e._id===t._id})<0){this.products.push(t)}this.setValue(i)};t.prototype.addProduct=function(t){if(t.outofstock){return}var e=this.value||{};if(!c(this.value)){this.value={}}e[t._id]=e[t._id]||0;if(this.isPresence){e[t._id]=1}else{e[t._id]+=t.step-0||1}if(this.products&&this.products.findIndex(function(e){return e._id===t._id})<0){this.products.push(t)}this.setValue(e)};t.prototype.removeProduct=function(t){if(t.outofstock){return}var e=this.value||{};e[t._id]=e[t._id]||0;e[t._id]-=t.step-0||1;if(e[t._id]<=0){e[t._id]=0}this.setValue(e)};t.prototype.clearProduct=function(t){var e=this.value||{};e[t._id]=0;this.setValue(e)};t.prototype.getProductRefs=function(){return l(d(this.value||{}),["price","total"])};t.prototype.getTotalAndPrice=function(){var t=this;var e=this.getProductRefs();var i=0;var r=0;e.forEach(function(e){var n=t.value[e];if(n>0){i+=n}if(t.products){var o=t.products.find(function(t){return t._id===e});if(n>0&&o&&o.price>0){r+=n*o.price}}});return{total:i,price:r}};t.prototype.setValue=function(t){var e=this.getTotalAndPrice();t=t||{};t.price=e.price;t.total=e.total;f(t,this)};t.prototype.onOpenCatalogDialog=function(t){var e=this;this.dialog=document.createElement("yoo-form-catalog-dialog");this.dialog.product=t;p(this.dialog,{half:false},null,"slideXEnterAnimation","slideXLeaveAnimation",true).then(function(t){e.dialog=null})};t.prototype.renderProducts=function(t){if(t&&this.isCheck){return r("yoo-entity",{class:"simple no-border",displayType:"card-list",entityType:"products",item:this.value})}var e=this.getTotalAndPrice();return e.total>0?r("div",{class:"products"},r("div",{class:"title"}," ",a("PRODUCTS")),r("div",{class:"subtitle"}," ",e.total+" "+a("ITEMS")),this.renderInnerProducts(t),!this.isInventory&&!this.isPresence&&!this.isCheck?r("div",{class:"footer"},r("div",{class:"title"},a("TOTAL"),":"),r("div",{class:"price"},h.currency.transform(e.price))):null):null};t.prototype.renderInnerProducts=function(t){var e=this;if(this.products&&this.products.length>0){var i=this.getProductRefs();return i.map(function(i){var n=e.value[i];var o=e.products.find(function(t){return t._id===i});if(n>0&&o){var s=o.price*n;return[r("div",{class:"entity"},r("yoo-entity",{onClick:function(){return e.onOpenCatalogDialog(o)},class:"catalog-display",isHistory:e.isHistory,displayType:"card-list",entityType:"products",item:o}),t?null:r("div",{class:"remove",onClick:function(t){return e.clearProduct(o)}}," ",r("yoo-icon",{class:"yo-cross"})," ")),e.isPresence?null:r("div",{class:{toolbar:true,history:e.isHistory}},r("div",{class:"title"},a("QUANTITY"),": "),t?null:r("div",{class:"icon right",onClick:function(t){return e.removeProduct(o)}}," ","-"," "),r("div",{class:"quantity"},t?n:r("yoo-form-input",{value:n,hasIconPrefix:false,clearable:false,forceValueUpdate:true,onInputChanged:function(t){t.stopPropagation();e.setProduct(o,t.detail)},type:"number"}),e.isHistory&&!e.isInventory&&s>0?r("span",null,"x"):null),t?null:r("div",{class:"icon left",onClick:function(t){return e.addProduct(o)}}," ","+"," "),!e.isInventory&&s>0?r("div",{class:"price"},h.currency.transform(s)," "):null)]}})}};t.prototype.onAutoCompleteValidityChanged=function(t){t.stopPropagation()};t.prototype.renderEditable=function(){var t=this;return r("div",{class:"outer-container"},r("yoo-form-autocomplete",{ref:function(e){return t.formAutocomplete=e},multiple:!this.isCheck,value:this.selectedProducts,entityType:"products",displayType:"card-list",iconPrefix:"yo-catalogue",onFetchData:function(e){return t.onFetchData(e)},onFetchFieldFilterData:function(e){return t.onFetchFieldFilterData(e)},onInputChanged:function(e){return t.onSelect(e)},onInputBlurred:function(e){return t.onInputBlurred(e)},onInputFocused:function(e){return t.onInputFocused(e)},onValidityChanged:function(e){return t.onAutoCompleteValidityChanged(e)},placeholder:a("ADDPRODUCTTOBASKET"),hideSelectionFromInput:!this.isCheck,tags:this.tags,isLocal:false,model:this.model,inputTabIndex:this.inputTabIndex}),r("div",{class:"or"},a("OR")),r("yoo-form-barcode",{onInputChanged:function(e){return t.onScanned(e)},placeholder:a("SCANPRODUCTTOBASKET"),hideValue:true}),this.notFoundError?r("div",{class:"error",innerHTML:this.notFoundError}):null,this.isCheck?null:this.renderProducts(false))};t.prototype.renderHistory=function(){return r("yoo-ion-scroll",{class:"relative"},this.renderReadonly())};t.prototype.renderReadonly=function(){return r("div",{class:"readonly"},this.renderProducts(true))};t.prototype.render=function(){if(this.isHistory){return this.renderHistory()}return this.readonly?this.renderReadonly():this.renderEditable()};Object.defineProperty(t.prototype,"host",{get:function(){return n(this)},enumerable:true,configurable:true});Object.defineProperty(t,"style",{get:function(){return".iframe-root{top:0;right:0;bottom:0;left:0;position:absolute;color:var(--black);overflow-y:auto;scrollbar-width:none}.iframe-root yoo-app .wrapper{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;height:100%;width:100%}.iframe-root yoo-app .wrapper.center-center{-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%}.iframe-root::-webkit-scrollbar{display:none}:host .outer-container,:host .readonly{padding:.5rem;padding-left:0;padding-bottom:0}:host .outer-container .or,:host .readonly .or{padding:.5rem;color:var(--text-color,#807f83);font-size:var(--font-size-02,.875rem);text-align:center}:host .outer-container .selected,:host .readonly .selected{background-color:var(--light,#fff)}:host .outer-container .error,:host .readonly .error{color:var(--danger,#ff625f)}:host .outer-container .products>.title,:host .readonly .products>.title{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;margin-top:.5rem;color:var(--black,#000);font-size:var(--font-size-03,1rem);font-weight:var(--font-weight-01,300);line-height:1.5;text-align:left;text-transform:uppercase}:host .outer-container .products .subtitle,:host .readonly .products .subtitle{margin-top:.125rem;color:var(--text-color,#807f83);font-size:var(--font-size-01,.75rem)}:host .outer-container .products .remove,:host .readonly .products .remove{display:-ms-flexbox;display:flex;-ms-flex-line-pack:center;align-content:center;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;min-width:40px;text-align:center}:host .outer-container .products .entity,:host .readonly .products .entity{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row}:host .outer-container .products .toolbar,:host .readonly .products .toolbar{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;padding:.5rem;border-top:1px solid var(--stable-light,#f1f1f1);border-bottom:1px solid var(--stable-light,#f1f1f1);font-size:var(--font-size-03,1rem)}:host .outer-container .products .toolbar.history,:host .readonly .products .toolbar.history{font-size:var(--font-size-02,.875rem)}:host .outer-container .products .toolbar .title,:host .readonly .products .toolbar .title{-ms-flex:1;flex:1;padding:3px .5rem 3px 0;color:var(--black,#000);font-size:var(--font-size-01,.75rem)}:host .outer-container .products .toolbar .title.align-right,:host .readonly .products .toolbar .title.align-right{text-align:right}:host .outer-container .products .toolbar .quantity,:host .readonly .products .toolbar .quantity{padding:0 .5rem;color:var(--black,#000);text-align:center}:host .outer-container .products .toolbar .quantity yoo-form-input,:host .readonly .products .toolbar .quantity yoo-form-input{width:100px}:host .outer-container .products .toolbar .price,:host .readonly .products .toolbar .price{-ms-flex:1;flex:1;padding-left:.5rem;color:var(--black,#000);text-align:right;white-space:nowrap}:host .outer-container .products .toolbar .icon,:host .readonly .products .toolbar .icon{width:22px;min-width:22px;height:22px;min-height:22px;border-radius:50%;background:var(--stable-light,#f1f1f1);text-align:center}:host .outer-container .products .footer,:host .readonly .products .footer{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:.5rem;padding-top:1rem;padding-bottom:.5rem;color:var(--black,#000)}:host .outer-container .products .footer .title,:host .readonly .products .footer .title{-ms-flex:1;flex:1;text-transform:uppercase}:host .outer-container .products .footer .price,:host .readonly .products .footer .price{text-align:right}:host(.history) .readonly{max-width:800px}"},enumerable:true,configurable:true});return t}())}}});