import{r as t,c as s,h as i,g as e}from"./p-0d847530.js";import{V as h,fX as o,ao as a,t as n,fY as l,al as r,p as c}from"./p-384bfcf6.js";import"./p-0f3d65ca.js";import"./p-8cff990b.js";import"./p-0d62bf9d.js";import"./p-d70b188c.js";import"./p-815d6c40.js";const d=class{constructor(i){t(this,i),this.initialSlide=0,this.isLoading=!1,this.search=s(this,"search",7),this.cancel=s(this,"cancel",7),this.selected=s(this,"selected",7),this.clearRecents=s(this,"clearRecents",7),this.fieldFetchData=s(this,"fieldFetchData",7)}async updateData(t,s){let i=s.tab;if(this.generalData=null,i&&"general"===i.id&&t&&!h(t)&&o(t).length>0)this.generalData=t;else{let e=this.config.indexOf(i),h=a(this.host,"[attr-name=grid-"+e+"]");h&&(h.items=s.appendData?[...h.items||[],...t]:t)}this.isLoading=!1}async upsertData(t,s){let i=a(this.host,"[attr-name=grid-"+s+"]");if(i.items){let s=i.items.findIndex(s=>s._id===t._id);s>=0?i.items[s]=Object.assign({},t):(i.items.unshift(t),i.items=i.items.slice())}}async removeData(t,s){let i=a(this.host,"[attr-name=grid-"+s+"]");i.items&&i.items.findIndex(s=>s._id===t._id)>=0&&(i.items=[...i.items.filter(s=>s._id!==t._id)])}componentWillLoad(){this.tabs=this.config.map(t=>({title:t.title||n(t.collectionName.toUpperCase()),value:t.id})),this.refreshers={},this.grids={}}componentDidLoad(){this.currentTagsSelected={},this.currentSortsAndFilters={}}onCancel(){this.cancel.emit(null)}refresh(t){this.ionSlides&&this.ionSlides.getActiveIndex().then(s=>{this.navBar&&this.navBar.selectedTab&&(this.currentSearch||this.config[s]&&this.config[s].collectionName)&&(this.search.emit({search:this.currentSearch,tab:this.config[s],tags:this.currentTagsSelected[this.navBar.selectedTab.value],sortsAndFilters:this.currentSortsAndFilters[this.navBar.selectedTab.value],currentPage:t?t.currentPage:0,pageSize:t?t.pageSize:20,appendData:!!t&&t.appendData,infiniteScroll:t?t.infiniteScroll:null}),this.isLoading=!0)})}onGridFetchData(t,s){this.refresh(t.detail)}onGridPullToRefresh(t){let s=this.grids[t.id],i=this.refreshers[t.id];s&&i&&s.pullToRefresh(i)}onEntitySelect(t,s,i){t.stopPropagation(),(s=l(s)).collectionName=s.collectionName||i,this.selected.emit({entity:t.detail,tab:s})}onShowFilterAdvanced(t){if(this.navBar&&this.navBar.selectedTab){this.currentSortsAndFilters=this.currentSortsAndFilters||{};let s=document.createElement("yoo-entity-search-dialog");s.model=t,s.values=this.currentSortsAndFilters[this.navBar.selectedTab.value];let i=t=>{t.stopPropagation(),this.fieldFetchData.emit(t.detail)};s.addEventListener("fieldFetchData",i),r(s).then(t=>{s&&(s.removeEventListener("fieldFetchData",i),s=null),t&&t.data&&(this.currentSortsAndFilters[this.navBar.selectedTab.value]=t.data,this.refresh())})}}onIonSlideDidChange(t){this.ionSlides&&this.navBar&&this.ionSlides.getActiveIndex().then(t=>{this.navBar.getActiveIndex().then(s=>{s!==t&&this.navBar.onSelectTab(this.tabs[t],t),this.currentSearch&&this.refresh()})}),this.generalData=null}onTabSelected(t){this.ionSlides&&this.navBar&&this.navBar.getActiveIndex().then(t=>this.ionSlides.getActiveIndex().then(s=>{s!==t&&this.ionSlides.slideTo(t,200,!0)})),this.generalData=null}onTagSelect(t){t.stopPropagation(),this.navBar&&this.navBar.selectedTab&&this.navBar.selectedTab.value&&(this.currentTagsSelected[this.navBar.selectedTab.value]=t.detail,this.refresh())}onRecentSearchSelect(t){this.onInputChanged(t)}onRecentClear(t){this.clearRecents.emit(t)}onInputChanged(t){this.currentSearch=t.detail,this.refresh()}renderHeader(){return i("yoo-header",null,i("yoo-ion-toolbar",{color:"light",centerTitle:!1},i("yoo-ion-buttons",{slot:"start"}),i("yoo-form-input",{value:this.currentSearch,class:"search","icon-prefix":"yo-search",hideOptional:!0,forceValueUpdate:!0,onInputChanged:t=>this.onInputChanged(t),placeholder:n("SEARCH")}),i("yoo-ion-buttons",{slot:"end"},i("yoo-ion-button",{class:{close:!0,"button-clear":!0,"text-color":c()},onClick:()=>this.onCancel()},c()?i("yoo-icon",{class:"yo-close"}):n("CANCEL")))),i("yoo-navbar",{class:"items-space-around",ref:t=>this.navBar=t,withLine:!0,tabs:this.tabs,onTabSelected:t=>this.onTabSelected(t)}))}renderBody(){return i("yoo-ion-content",{class:"bg-light",scrollEnabled:!1},i("yoo-ion-slides",{class:"entity-search-display",ref:t=>this.ionSlides=t,initialSlide:this.initialSlide,onIonSlideDidChange:t=>this.onIonSlideDidChange(t),options:{autoplay:!1}},this.config?this.config.map((t,s)=>i("yoo-ion-slide",null,i("yoo-ion-content",null,i("div",{class:"content"},t.collectionName&&i("div",{class:"toolbar"},i("yoo-entity-search-tags",{onFilterAdvanced:()=>this.onShowFilterAdvanced(t),tags:t.tags,sortsAndFilters:this.currentSortsAndFilters?this.currentSortsAndFilters[t.id]:null,hideAdvancedFilters:!0===t.hideAdvancedFilters,onSelected:t=>this.onTagSelect(t)})),i("yoo-ion-refresher",{ref:s=>this.refreshers[t.id]=s,slot:"fixed",onIonRefresh:()=>this.onGridPullToRefresh(t),disabled:!1},i("yoo-ion-refresher-content",{pullingText:n("PULLTOREFRESH")})),!this.generalData&&i("yoo-grid",{ref:s=>this.grids[t.id]=s,class:"entity-search",hideHeader:!0,hideEmptyState:t.recents&&t.recents.length>0,isLocal:!1,emptyState:t.emptyState||t.collectionName,entityType:t.collectionName,displayType:t.displayType||"card-list","attr-name":"grid-"+s,isCollapsible:t.isCollapsible,onSelected:s=>this.onEntitySelect(s,t),onFetchData:s=>this.onGridFetchData(s,t),icons:t.icons,extraClass:t.extraClass},!this.isLoading&&t.recents&&t.recents.length>0?i("yoo-entity-search-recent",{slot:"emptystate",values:t.recents,onSelected:t=>this.onRecentSearchSelect(t),onClear:()=>this.onRecentClear(t)}):null),this.generalData&&o(this.generalData).map(s=>i("yoo-grid",{class:"entity-search general",heading:n(s.toUpperCase()),forceHeading:!0,hideTotal:!0,hideToolbar:!0,hideEmptyState:t.recents&&t.recents.length>0,isLocal:!0,emptyState:s,entityType:s,displayType:"card-list",onSelected:i=>this.onEntitySelect(i,t,s),onFetchData:s=>this.onGridFetchData(s,t),items:this.generalData[s]})),this.isLoading&&i("yoo-loader",{class:"fixed lg backdrop",text:"LOADING"}))))):null))}render(){return[this.renderHeader(),this.renderBody()]}get host(){return e(this)}static get style(){return".iframe-root{top:0;right:0;bottom:0;left:0;position:absolute;color:var(--black);overflow-y:auto;scrollbar-width:none}.iframe-root yoo-app .wrapper{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;height:100%;width:100%}.iframe-root yoo-app .wrapper.center-center{-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%}.iframe-root::-webkit-scrollbar{display:none}:host{position:absolute;top:0;left:0;right:0;bottom:0;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:justify;justify-content:space-between}:host .header,:host yoo-header{width:unset;padding:.5rem;padding-bottom:0;background:var(--light,#fff)}:host .header yoo-ion-buttons,:host yoo-header yoo-ion-buttons{margin-left:1rem}:host .content yoo-ion-slides,:host yoo-ion-content yoo-ion-slides{position:absolute;top:0;left:0;right:0;bottom:0}:host .content .toolbar,:host yoo-ion-content .toolbar{padding-top:1rem}:host .content yoo-grid.general,:host yoo-ion-content yoo-grid.general{margin-top:1rem}:host yoo-navbar{--width-outer-container:unset}"}};export{d as yoo_entity_search};