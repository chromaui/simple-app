import{r as s,c as t,h as i,g as e}from"./p-0d847530.js";import{i as o,b as n,cK as h,cJ as r,o as a,z as l,q as c,t as d,S as u,p as y,bq as p}from"./p-384bfcf6.js";import"./p-0f3d65ca.js";import"./p-8cff990b.js";import"./p-0d62bf9d.js";import"./p-d70b188c.js";import"./p-815d6c40.js";const g=class{constructor(i){s(this,i),this.messages=[],this.allowPhoto=!0,this.allowGif=!0,this.allowAudio=!0,this.allowVideo=!0,this.selectedTimeTokens=[],this.loadMoreClicked=t(this,"loadMoreClicked",7),this.sendText=t(this,"sendText",7),this.sendChatMedia=t(this,"sendChatMedia",7),this.closePage=t(this,"closePage",7),this.showMore=t(this,"showMore",7),this.closeDeleteMode=t(this,"closeDeleteMode",7),this.selected=t(this,"selected",7),this.deleteMessages=t(this,"deleteMessages",7),this.conferenceMessageClicked=t(this,"conferenceMessageClicked",7),this.isTyping=t(this,"isTyping",7),this.startVideocall=t(this,"startVideocall",7)}onPlaying(s){s&&s.detail&&(this.currentActivePlayerId=s.detail)}async scrollToBottom(){if(this.scroll)return this.scroll.scrollToBottom(200)}async scrollToTop(){return this.scrollToInternal(0)}async scrollToInternal(s){this.scroll&&this.scroll.scrollToPoint(0,s,0)}async forceMessageRefresh(s){this.newMessageArr=[...s]}async componentDidLoad(){this.ionContent&&(this.scroll=await this.ionContent.getScrollElement(),o()&&n()&&this.enableKeyboardResizing&&h(Keyboard))}componentDidUnload(){o()&&n()&&this.enableKeyboardResizing&&r(Keyboard)}isSomeoneTyping(){return this.usersTyping&&Object.keys(this.usersTyping).length>0}getLastMessage(s){return s===this.newMessageArr.length-1||this.newMessageArr[s].author!==this.newMessageArr[s+1].author}getFirstMessage(s){return 0===s||this.newMessageArr[s].author!==this.newMessageArr[s-1].author}isNextImage(s){return this.newMessageArr&&this.newMessageArr[s+1]&&!a(this.newMessageArr[s+1].img)}onSendText(s){s.stopPropagation(),this.scrollToBottom(),this.sendText.emit(s.detail)}onSendChatMedia(s){s.stopPropagation(),this.scrollToBottom(),this.sendChatMedia.emit(s.detail)}onPullToRefresh(){this.loadMoreClicked.emit(!0),setTimeout(()=>{this.refresher.complete()},300)}onCloseDeleteMode(){this.selectedTimeTokens=[],this.closeDeleteMode.emit(!1)}onSelectMessages(s=!0){this.selectedTimeTokens=[],s&&this.messages.forEach(s=>{s&&!s.deleted&&s.author&&s.author._id===l().user._id&&this.selectedTimeTokens.push(s.timetoken)}),this.selected.emit(this.selectedTimeTokens)}onClickMessage(s,t){let i=s.detail||!1;this.selectedTimeTokens=[],this.messages.forEach(s=>{s&&(s.timetoken!==t&&s.selected||s.timetoken===t&&i)&&this.selectedTimeTokens.push(s.timetoken)}),this.selected.emit(this.selectedTimeTokens)}onDeleteMessages(){this.selectedTimeTokens.length>0&&c([{text:d("DELETE"),cssClass:"danger",handler:()=>{this.selectedTimeTokens=[],this.deleteMessages.emit(!0)}}],"stable")}onIsTyping(s){this.isTyping.emit(s&&s.detail||!1)}onMapChatActions(s){return this.chatSecondaryActions.map(t=>Object.assign({},t,{isVisible:()=>!t.isVisible||t.isVisible(s),handler:()=>t.handler?t.handler(s):""}))}onHighlightMessage(s){s&&s.detail&&this.chatSecondaryActions&&this.chatSecondaryActions.length>0&&c(this.onMapChatActions(s.detail.message),"danger",{preventOverlayClick:!0})}renderReadOnlyHeader(){return i("yoo-header",{class:"shadow"},i("yoo-ion-toolbar",{color:"light"},(this.closeIcon||!y())&&i("yoo-ion-buttons",{slot:"start"},i("yoo-ion-button",{color:"text-color",onClick:()=>this.closePage.emit(!0)},i("yoo-icon",{slot:"icon-only",class:this.closeIcon?this.closeIcon:"yo-left"}))),i("yoo-title",null,this.heading),i("yoo-ion-buttons",{slot:"end"},this.canVideoCall&&i("yoo-ion-button",{color:"text-color",onClick:()=>this.startVideocall.emit(!0)},i("yoo-icon",{slot:"icon-only",class:"yo-videocamera "+u()})),i("yoo-ion-button",{color:"text-color",onClick:()=>this.showMore.emit(!0)},i("yoo-icon",{slot:"icon-only",class:"yo-more"})))))}renderEditableHeader(){return i("yoo-header",{class:"shadow delete-mode-header"},i("yoo-ion-toolbar",{color:"success"},i("yoo-ion-buttons",{slot:"start"},i("yoo-ion-button",{color:"success",onClick:()=>this.onSelectMessages(!0)},d("SELECTALL"))),i("yoo-ion-buttons",{slot:"end"},i("yoo-ion-button",{color:"success",onClick:()=>this.onCloseDeleteMode()},d("CANCEL")))))}renderInputBar(){return i("yoo-input-bar",{class:"footer",placeholder:this.inputPlaceHolder,otherIds:this.otherIds,keepFocusAfterAction:!0,onIsTyping:s=>{this.onIsTyping(s)},allowMention:this.isMultiple,allowPhoto:this.allowPhoto,allowGif:this.allowGif,allowAudio:this.allowAudio,allowVideo:this.allowVideo,onSendAudio:s=>this.onSendChatMedia(s),onSendVideo:s=>this.onSendChatMedia(s),onSendPicture:s=>this.onSendChatMedia(s)})}renderDeleteModeFooter(){return i("div",{class:"delete-mode-footer "+(this.selectedTimeTokens.length>0?u():"disabled")},i("div",{class:"inner-container",onClick:()=>this.onDeleteMessages()},i("yoo-icon",{class:"yo-delete"})," ",d(this.selectedTimeTokens.length<=1?"DELETE_MESSAGE":"DELETE_MESSAGES",{number:this.selectedTimeTokens.length})))}renderTypingIcon(){return[i("div",{class:"user-typing"},i("div",{class:"typing-indicator"},i("span",null),i("span",null),i("span",null)))]}renderUserName(s){return s&&s.firstName&&s.lastName&&i("div",{class:"username"},`${s.firstName} ${s.lastName} ${d("ISTYPING")}...`)}renderUser(s){return i("div",{class:"user-container"},s&&i("yoo-avatar",{class:"m",avatarIconSize:"m",user:s}))}renderIsTypingMultiple(){return Object.keys(this.usersTyping).map(s=>[this.renderUserName(this.usersTyping[s]),i("div",{class:"bottom-part"},this.renderUser(this.usersTyping[s]),this.renderTypingIcon())])}renderSomeoneIsTyping(){return[i("div",{class:"someone-typing-container"},this.isMultiple?this.renderIsTypingMultiple():this.renderTypingIcon())]}renderChatMessage(){return this.newMessageArr=this.messages.filter(s=>s&&!s.deleted),this.newMessageArr.map((s,t)=>[i("yoo-chat-message",{onConferenceMessageClicked:s=>{this.conferenceMessageClicked.emit(s.detail)},message:s,isLast:this.getLastMessage(t),isFirst:this.getFirstMessage(t),onClicked:t=>this.onClickMessage(t,s.timetoken),isNextImage:this.isNextImage(t),isGroup:this.isMultiple,onPresshold:s=>this.onHighlightMessage(s),currentActivePlayerId:this.currentActivePlayerId})])}render(){return[this.disableHeader?null:this.deleteModeEnabled?this.renderEditableHeader():this.renderReadOnlyHeader(),i("yoo-ion-content",{class:this.transparent?"":"bg-light",forceOverscroll:!1,ref:s=>this.ionContent=s},i("yoo-ion-refresher",{class:this.transparent?"transparent":"",slot:"fixed",onIonRefresh:()=>this.onPullToRefresh(),disabled:this.deleteModeEnabled,ref:s=>this.refresher=s},i("yoo-ion-refresher-content",{pullingText:d("PULLTOREFRESH")})),i("div",{class:{"messages-container":!0,"iphone-x":p()}},this.messages&&this.renderChatMessage(),this.isSomeoneTyping()&&this.renderSomeoneIsTyping())),this.hideInputBar?null:this.deleteModeEnabled?this.renderDeleteModeFooter():this.renderInputBar()]}get host(){return e(this)}static get style(){return".iframe-root{top:0;right:0;bottom:0;left:0;position:absolute;color:var(--black);overflow-y:auto;scrollbar-width:none}.iframe-root yoo-app .wrapper{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;height:100%;width:100%}.iframe-root yoo-app .wrapper.center-center{-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%}.iframe-root::-webkit-scrollbar{display:none}:host{--typing-username-padding-left:45px;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;height:100%}\@-webkit-keyframes slide-up{0%{-webkit-transform:translateY(3rem);transform:translateY(3rem)}to{-webkit-transform:translateY(0);transform:translateY(0)}}\@keyframes slide-up{0%{-webkit-transform:translateY(3rem);transform:translateY(3rem)}to{-webkit-transform:translateY(0);transform:translateY(0)}}\@-webkit-keyframes slide-down{0%{-webkit-transform:translateY(-3rem);transform:translateY(-3rem)}to{-webkit-transform:translateY(0);transform:translateY(0)}}\@keyframes slide-down{0%{-webkit-transform:translateY(-3rem);transform:translateY(-3rem)}to{-webkit-transform:translateY(0);transform:translateY(0)}}:host .delete-mode-header{-webkit-animation:slide-down .4s ease;animation:slide-down .4s ease}:host .messages-container{margin-top:.2rem;padding:.3125rem .625rem 5.625rem .625rem}:host .messages-container,:host .messages-container .someone-typing-container{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column}:host .messages-container .someone-typing-container{padding-top:var(--padding-10,.625rem)}:host .messages-container .someone-typing-container .user-typing{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:56px;height:36px;border-radius:18px;background-color:var(--stable-light)}:host .messages-container .someone-typing-container .user-typing .typing-indicator{background-color:var(--stable-light,#f1f1f1);will-change:transform;width:auto;border-radius:50px;display:-ms-flexbox;display:flex;margin:0 auto;position:relative;-webkit-animation:bulge 2s ease-out infinite;animation:bulge 2s ease-out infinite}:host .messages-container .someone-typing-container .user-typing .typing-indicator:after,:host .messages-container .someone-typing-container .user-typing .typing-indicator:before{content:\"\";position:absolute;bottom:-2px;left:-2px;height:8px;width:8px;border-radius:50%;background-color:var(--stable-light,#f1f1f1)}:host .messages-container .someone-typing-container .user-typing .typing-indicator:after{height:3px;width:3px;left:-3px;bottom:-3px}:host .messages-container .someone-typing-container .user-typing .typing-indicator span{height:8px;width:8px;float:left;margin:0 1px;background-color:var(--stable,#adadad);display:block;border-radius:50%;opacity:.4}:host .messages-container .someone-typing-container .user-typing .typing-indicator span:first-of-type{-webkit-animation:blink 1s .3333s infinite;animation:blink 1s .3333s infinite}:host .messages-container .someone-typing-container .user-typing .typing-indicator span:nth-of-type(2){-webkit-animation:blink 1s .6666s infinite;animation:blink 1s .6666s infinite}:host .messages-container .someone-typing-container .user-typing .typing-indicator span:nth-of-type(3){-webkit-animation:blink 1s .9999s infinite;animation:blink 1s .9999s infinite}\@-webkit-keyframes blink{50%{opacity:1}}\@keyframes blink{50%{opacity:1}}\@-webkit-keyframes bulge{50%{-webkit-transform:scale(1.05);transform:scale(1.05)}}\@keyframes bulge{50%{-webkit-transform:scale(1.05);transform:scale(1.05)}}:host .messages-container .someone-typing-container .username{padding-bottom:3px;padding-left:var(--typing-username-padding-left);color:var(--text-color,#807f83);font-size:var(--font-size-02,.875rem)}:host .messages-container .someone-typing-container .bottom-part{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding-left:var(--padding-5,.3125rem)}:host .delete-mode-footer{display:-ms-flexbox;display:flex;position:relative;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;min-height:3rem;background:var(--light,#fff);font-weight:var(--font-weight-01,300);-webkit-box-shadow:var(--footer-shadow,0 1px 10px 0 rgba(0,0,0,.15));box-shadow:var(--footer-shadow,0 1px 10px 0 rgba(0,0,0,.15));-webkit-animation:slide-up .4s ease;animation:slide-up .4s ease}:host .delete-mode-footer .text-success{color:var(--success,#04cc99)!important}:host .delete-mode-footer .text-danger{color:var(--danger,#ff625f)!important}:host .delete-mode-footer .text-danger-light{color:var(--danger-light,#f46885)!important}:host .delete-mode-footer .text-energized{color:var(--energized,#fed05b)!important}:host .delete-mode-footer .text-royal{color:var(--royal,#845cff)!important}:host .delete-mode-footer .text-info{color:var(--info,#fc459e)!important}:host .delete-mode-footer .text-dark{color:var(--dark,#2b3648)!important}:host .delete-mode-footer .text-text-color{color:var(--text-color,#807f83)!important}:host .delete-mode-footer .text-light{color:var(--light,#fff)!important}:host .delete-mode-footer .text-always-light{color:var(--always-light,#fff)!important}:host .delete-mode-footer .text-light-orange{color:var(--light-orange,#fcae49)!important}:host .delete-mode-footer .text-stable-light{color:var(--stable-light,#f1f1f1)!important}:host .delete-mode-footer .text-stable{color:var(--stable,#adadad)!important}:host .delete-mode-footer .text-warning{color:var(--warning,#ff6402)!important}:host .delete-mode-footer .text-accent{color:var(--accent,#1fb6ff)!important}:host .delete-mode-footer .inner-container{margin-left:var(--padding-15,.9375rem)}:host .delete-mode-footer.disabled{color:var(--stable-40,hsla(0,0%,67.8%,.4))}:host yoo-input-bar{--padding-input-container:0;position:absolute;bottom:0;width:100%;z-index:40000}"}};export{g as yoo_chat};