import{r as i,c as s,h as t,H as o,g as h}from"./p-0d847530.js";import{t as n,ao as e,bq as a,i as l,cF as c,bt as r,bu as u,al as d,q as p,Q as f,b as y,z as m,ak as b,p as C}from"./p-384bfcf6.js";import"./p-0f3d65ca.js";import"./p-8cff990b.js";import"./p-0d62bf9d.js";import{as as v,a6 as E,a7 as g,ar as k,dj as I,dk as w,av as O,at as T,r as A,dl as P,G as D,aA as M}from"./p-d70b188c.js";import"./p-815d6c40.js";const j=class{constructor(t){i(this,t),this.icon="yo-camera",this.iconAction="yo-photo-library",this.actionText=n("SEND"),this.value="",this.placeholder=n("ADDCOMMENT"),this.topIndication=null,this.replyToUser=null,this.keepFocusAfterAction=!1,this.allowMention=!1,this.allowPhoto=!0,this.allowGif=!0,this.allowAudio=!1,this.allowVideo=!0,this.focused=!1,this.sendText=s(this,"sendText",7),this.iconClicked=s(this,"iconClicked",7),this.browseLibrary=s(this,"browseLibrary",7),this.rowNumberChanged=s(this,"rowNumberChanged",7),this.sendPicture=s(this,"sendPicture",7),this.sendVideo=s(this,"sendVideo",7),this.sendAudio=s(this,"sendAudio",7),this.replyCancelled=s(this,"replyCancelled",7),this.isTyping=s(this,"isTyping",7)}async focusInputField(i=!1){let s=e(this.host,"yoo-form-text-area");this.hasTextInside=i,s&&s.setFocus()}componentWillLoad(){this.host.classList.contains("footer")&&a()&&this.host.classList.add("iphone-x-padding"),this.isRendered=!1}componentDidLoad(){this.focusOnOpen&&setTimeout(()=>{this.focusInputField()},500),this.getPlaceholderAccordingToSize(),this.isRendered=!0}getPlaceholderAccordingToSize(){let i=e(this.host,".input-bar.boost");if(i){let s=Math.trunc((i.offsetWidth-16)/6);this.placeholderAccordingToSize=this.placeholder.length>=s?this.placeholder.slice(0,s-4)+" ...":this.placeholder}}onActionClick(){this.keepFocusAfterAction&&this.formTextArea&&this.formTextArea.setFocus(),this.hasTextInside||this.value&&""!==this.value?(this.sendText.emit(this.value),this.value=null,this.hasTextInside=!1):(this.browseLibrary.emit(!0),l()?v({allowVideo:this.allowVideo}).then(i=>{let s=i;s&&(s.indexOf("file://")<0&&(s="file://"+s),E(s)?this.sendPicture.emit(s):g(s)?this.sendVideo.emit(s):c(n("UNSUPPORTEDFORMAT"),[n("OK")]))}):this.captureFile())}captureFile(){if(this.fileInput){let i;r()||u()?(i=document.createEvent("MouseEvent")).initMouseEvent("click",!1,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null):i=new MouseEvent("click",{bubbles:!1}),this.fileInput.dispatchEvent(i)}}async onCapturePicture(){if(l())k(70,w.CAMERA,I.PICTURE,!1).then(i=>{this.sendPicture.emit(i)});else{let i=await O(),s=document.createElement("yoo-form-capture-webcam-dialog");if(!(i&&i.length>0))return;s.device=i[0],d(s).then(i=>{i&&i.data&&this.sendPicture.emit(i.data),s=null})}}onCaptureVideo(){l()&&T().then(i=>{i&&i.length&&this.sendVideo.emit(i[0].fullPath)})}onShowActionSheet(){if(l()&&this.allowVideo){this.iconClicked.emit(!0);let i=[{type:"photo",text:n("PHOTO"),handler:()=>this.onCapturePicture()},{type:"video",text:n("VIDEO"),handler:()=>this.onCaptureVideo()}];p(i)}else this.onCapturePicture()}onInput(i){this.value=i.target.value,this.hasTextInside=this.value&&this.value.length>0,this.onEmitTypingEvent(!0)}onEmitTypingEvent(i){i!==this.previousIsTyping&&(this.isTyping.emit(i),this.previousIsTyping=i)}async onFileSelect(i){if(!l()&&i.target.files){let s=i.target.files[0];E(s)&&await A(s,"blob").then(i=>{s=i}),this.sendPicture.emit(s)}}onCloseReplyMode(i){this.replyToUser=null,this.replyCancelled.emit(!0)}onGifIconClicked(){f({type:"gif",params:{multiple:!1}}).then(i=>{i&&i.data&&i.data.embed_url&&this.sendPicture.emit(i.data.embed_url)})}onInputFocused(){this.focused=!0}onInputBlurred(){this.onEmitTypingEvent(!1),this.focused=!1}onMicIconClicked(){return P.captureAudio({limit:1,duration:60}).then(i=>{if(i&&i.length>0){let s=i[0].fullPath;l()&&!s.includes("file://")&&(s="file://"+s);let t=Promise.resolve(s);y()&&(t=D(s,!!m().user&&m().user.disablePhotoOrientationAutoFix)),t.then(i=>{this.sendAudio.emit(i)})}}).catch(i=>{3!==i.code&&this.noAudio()})}noAudio(){c(n("AUDIO"),[n("OK")],null,n("NOAUDIO"))}renderInputBarActions(){return this.hasTextInside?t("div",{onClick:()=>this.onActionClick()},this.actionText):t("div",{class:"input-bar-icon-container"},this.allowAudio&&t("yoo-icon",{onClick:()=>this.onMicIconClicked(),class:"yo-microphone"}),this.allowGif&&t("yoo-icon",{onClick:()=>this.onGifIconClicked(),class:"yo-gif"}),t("yoo-icon",{onClick:()=>this.onActionClick(),class:this.iconAction}))}render(){return t(o,{class:b()},t("div",{class:{"outer-container":!0,focused:this.focused}},this.topIndication||this.replyToUser?t("div",{class:"indications-container"},t("span",{class:"indications-inner"},this.topIndication?this.topIndication:this.replyToUser?t("span",null,n("REPLY_TO")+" ",t("span",{class:"user-indication"},M(this.replyToUser))):null),this.replyToUser?t("span",{class:"close-reply",onClick:i=>this.onCloseReplyMode(i)},t("yoo-icon",{class:"yo-close"})):null):null,t("div",{class:"input-container"},t("div",{class:"icon-container"},this.allowPhoto&&t("div",{class:"capture-icon",onClick:()=>this.onShowActionSheet()},t("yoo-icon",{class:this.icon}))),t("div",{class:"input-zone"},t("yoo-form-text-area",{ref:i=>this.formTextArea=i,class:"input-bar",resizable:"none",value:this.value,placeholder:this.isRendered&&this.placeholderAccordingToSize?this.placeholderAccordingToSize:this.placeholder,initialRows:1,allowMention:this.allowMention,maxRows:5,disableEnter:C(),onInputBlurred:()=>this.onInputBlurred(),onInputFocused:()=>this.onInputFocused(),onInputChanged:i=>this.onInput(i),onEnterPressed:()=>C()?this.onActionClick():null,otherIds:this.otherIds}),t("div",{class:"input-action"},this.renderInputBarActions(),this.hasTextInside?null:t("input",{ref:i=>this.fileInput=i,type:"file",class:"invisible",onChange:i=>this.onFileSelect(i)}))))))}get host(){return h(this)}static get style(){return".iframe-root{top:0;right:0;bottom:0;left:0;position:absolute;color:var(--black);overflow-y:auto;scrollbar-width:none}.iframe-root yoo-app .wrapper{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;height:100%;width:100%}.iframe-root yoo-app .wrapper.center-center{-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%}.iframe-root::-webkit-scrollbar{display:none}:host{--padding-input-container:0.5625rem var(--padding-15,0.9375rem) 1rem var(--padding-15,0.9375rem);--input-bar-placeholder-font-size:var(--font-size-03,1rem)}:host .outer-container{display:-ms-flexbox;display:flex;position:relative;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:end;align-items:flex-end;background:var(--light,#fff)}:host .outer-container.focused{min-height:0!important}:host .outer-container .indications-container{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;width:100%;padding-left:var(--padding-15,.9375rem);background:var(--stable-light,#f1f1f1);color:var(--text-color,#807f83);font-size:var(--font-size-01,.75rem)}:host .outer-container .indications-container .close-reply{padding-right:var(--padding-15,.9375rem)}:host .outer-container .indications-container .close-reply yoo-icon{color:var(--black,#000);font-weight:var(--font-weight-03,700)}:host .outer-container .indications-container .indications-inner{-ms-flex:1;flex:1;padding-left:var(--padding-15,.9375rem)}:host .outer-container .indications-container .indications-inner .user-indication{-ms-flex:1;flex:1;color:var(--black,#000);font-weight:var(--font-weight-03,700)}:host .outer-container .input-container{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;width:100%;padding:var(--padding-input-container);padding:0}:host .outer-container .input-container .icon-container{-ms-flex-item-align:center;align-self:center;margin-right:.5rem;margin-left:var(--padding-15,.9375rem)}:host .outer-container .input-container .icon-container .capture-icon{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:2rem;height:2rem;border:1px solid var(--success,#04cc99);border-radius:50%;background-color:var(--success,#04cc99);color:var(--light,#fff);font-size:var(--icon-size-01,1rem)}:host .outer-container .input-container .input-zone{display:-ms-flexbox;display:flex;position:relative;-ms-flex-align:center;align-items:center;width:100%;margin-right:.875rem;padding:0 .75rem 0 .8125rem;border:1px solid var(--stable,#adadad);border-radius:1.03125rem;background-color:var(--light,#fff)}:host .outer-container .input-container .input-zone yoo-form-text-area{--textarea-placeholder-font-size:var(--input-bar-placeholder-font-size);padding-right:1rem}:host .outer-container .input-container .input-zone .input-action{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;position:relative;width:150px;color:var(--success,#04cc99)}:host .outer-container .input-container .input-zone .input-action div{margin-left:auto}:host .outer-container .input-container .input-zone .input-action div.text{margin-bottom:.2rem}:host .outer-container .input-container .input-zone .input-action .input-bar-icon-container{position:absolute;right:0;font-size:var(--icon-size-01,1rem)}:host .outer-container .input-container .input-zone .input-action .input-bar-icon-container yoo-icon{padding-left:var(--padding-10,.625rem)}:host .outer-container .input-container .input-zone .input-action .invisible{display:block;top:0;left:50%;width:70px;margin-left:-50px;border-radius:50%;outline:none;background:var(--light,#fff);text-align:right;cursor:inherit;opacity:0;filter:alpha(opacity=0)}:host .outer-container .input-container .input-zone .input-action input[type=file]{pointer-events:none}:host(.footer) .outer-container{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;min-height:3rem;border-top:1px solid var(--stable-40,hsla(0,0%,67.8%,.4))}:host(.footer) .outer-container .input-container .input-zone{margin:.5rem .875rem .5rem 0}:host(.iphone-x-padding) .outer-container{-ms-flex-pack:start;justify-content:flex-start;min-height:4.375rem}:host(.boost) .outer-container .input-container .icon-container .capture-icon{border:1px solid var(--danger-light,#f46885);background-color:var(--danger-light,#f46885);color:var(--always-light,#fff)}:host(.boost) .outer-container .input-container .input-zone .input-action{min-height:2.8125rem;color:var(--danger-light,#f46885)}:host(.boost) .outer-container .input-container .input-zone .input-action div span{display:inline-block}:host(.accent) .outer-container .input-container{background-color:var(--accent,#1fb6ff)}:host(.accent) .outer-container .input-container .input-zone{border:1px solid var(--accent,#1fb6ff)}:host(.info) .outer-container .input-container{background-color:var(--info,#fc459e)}:host(.info) .outer-container .input-container .input-zone{border:1px solid var(--info,#fc459e)}:host(.dark) .outer-container .input-container{background-color:var(--dark,#2b3648)}:host(.dark) .outer-container .input-container .input-zone{border:1px solid var(--dark,#2b3648)}:host(.danger) .outer-container .input-container{background-color:var(--danger,#ff625f)}:host(.danger) .outer-container .input-container .input-zone{border:1px solid var(--danger,#ff625f)}:host(.warning) .outer-container .input-container{background-color:var(--warning,#ff6402)}:host(.warning) .outer-container .input-container .input-zone{border:1px solid var(--warning,#ff6402)}:host(.success) .outer-container .input-container{background-color:rgba(46,219,183,.5)}:host(.success) .outer-container .input-container .input-zone{border:1px solid var(--success,#04cc99)}:host(.squared) .outer-container .input-container .input-zone{border-radius:.25rem}"}};export{j as yoo_input_bar};