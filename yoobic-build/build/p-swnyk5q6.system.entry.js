System.register(["./p-d99b9c19.system.js","./p-76deb591.system.js","./p-40fcf55a.system.js","./p-fd4afab3.system.js","./p-e3fa184f.system.js","./p-90888482.system.js","./p-350cb6c0.system.js"],function(e){"use strict";var t,n,o,i,r,s,a,l,c,u;return{setters:[function(e){t=e.r;n=e.c;o=e.h;i=e.H},function(e){r=e.b8;s=e.b9;a=e.t;l=e.ak;c=e.be;u=e.dj},function(){},function(){},function(){},function(){},function(){}],execute:function(){var h=e("yoo_form_image_tagging",function(){function e(e){t(this,e);this.placeholder="DRAGDROPTAGS";this.zoneElements=[];this.zones=[];this.zoneData=[];this.validityChanged=n(this,"validityChanged",7);this.inputBlurred=n(this,"inputBlurred",7);this.inputFocused=n(this,"inputFocused",7);this.inputChanged=n(this,"inputChanged",7);this.dragStarted=n(this,"dragStarted",7);this.dragEnded=n(this,"dragEnded",7)}e.prototype.requiredWatch=function(){this.validate()};e.prototype.componentWillLoad=function(){this.tagsZoneIndex=this.checkArray(this.annotations)&&this.annotations.length;this.zoneData=this.setConfigZones()};e.prototype.componentDidLoad=function(){if(this.outerContainerElement){this.setImageRatio();this.createDropZones();this.configureDropZones();this.setTags()}};e.prototype.componentDidUpdate=function(){var e=this.checkArray(this.zoneElements)&&this.zoneElements.length===this.annotations.length+1;if(!e){this.createDropZones()}};e.prototype.validate=function(){if(this.checkArray(this.annotations)){this.validity=this.value.length===this.annotations.length;this.validityChanged.emit(this.validity);return this.validity}};e.prototype.setImageRatio=function(){if(this.imageElement){var e=2/3;var t=this.outerContainerElement.clientWidth;this.imageContainerElement.style.height=t*e+"px";this.imageElement.style.height=t*e+"px"}};e.prototype.configureDropZones=function(){var e=this;this.zones=this.zoneData.map(function(t){return e.setDropZone(t)})};e.prototype.setDropZone=function(e){if(this.checkArray(this.zoneElements)){e.element=this.zoneElements.find(function(t){return t.id===e.id});e.parent=e&&e.element&&e.element.parentNode;return e}};e.prototype.isTagsZone=function(e){return e==="zone-"+this.tagsZoneIndex};e.prototype.setConfigZones=function(){var e=this;if(this.annotations){var t=this.annotations.map(function(e,t){return t});t.push(this.tagsZoneIndex);return t.map(function(t){var n={};n.id="zone-"+t;n.threshold="60%";n.grid=e.isTagsZone(n.id);n.sortProp=e.isTagsZone(n.id)&&"value";n.tags=[];return n})}};e.prototype.setTags=function(){var e=this;if(this.checkArray(this.values)){if(this.checkArray(this.value)){if(!this.readonly){this.values.filter(function(t){return!e.value.includes(t)}).sort().forEach(function(t){return e.setTag(t,e.tagsZoneIndex)})}this.value.forEach(function(t,n){return e.setTag(t,n)})}else{this.values.sort().forEach(function(t){return e.setTag(t,e.tagsZoneIndex)})}}};e.prototype.configureTag=function(e,t){var n={};n.x=0;n.y=0;n.left=0;n.top=0;n.value=e;n.zone=this.zoneData.find(function(e){return e.id==="zone-"+t});n.element=this.addTagButton(n.zone,e);n.zone.element=n.element.parentElement;n.clone=n.element.cloneNode(true);n.clone.text=n.value;n.clone.classList.add("clone");n.lastZone=n.zone;return n};e.prototype.setTag=function(e,t){var n=this;var o=this.configureTag(e,t);this.setTweenLiteEffect([o.element,o.clone],{x:"+=0"});var i=function(){n.dragStarted.emit(true);if(o.zone&&!n.hitTest(o.zone,o.clone,0)){o.lastZone=o.zone;n.removeTag(o);o.zone=null}};var a=function(){o.draggable.disable();c.fromTo([o.element,o.clone],1,{scale:1.2},{scale:1},0);o.element.classList.remove("shadowed");o.clone.classList.remove("shadowed");n.setTweenLiteEffect(o.element,{left:0,top:0});var e=n.zones.every(function(e){return!n.hitTest(e,o.clone)});if(!o.zone){o.zone=o.lastZone;n.zones.forEach(function(e){if(n.hitTest(e,o.clone)&&!n.isDropZoneFull(e)){o.zone=e}})}n.addTag(o);var t=n.getOffset(o);var i={onComplete:function(){if(o.clone){n.outerContainerElement.removeChild(o.clone)}n.setTweenLiteEffect(o.element,{autoAlpha:1})}};if(e&&!o.isGrid){i["x"]="-="+t.x;i["y"]="-="+t.y}else if(!o.isGrid){var r=o.zone.element.getBoundingClientRect();o.left=t.x/r.width*100+"%";o.top=t.y/r.height*100+"%";n.setTweenLiteEffect(o.element,{left:o.left,top:o.top})}else{n.setTweenLiteEffect(o.element,{left:0,top:0});i["x"]="-="+t.x;i["y"]="-="+t.y}s.to(o.clone,.3,i);n.value=n.getUserAnswers();u(n.value,n);n.dragEnded.emit(true)};var l=function(){if(o.zone&&o.zone.id!=="zone-"+n.tagsZoneIndex){o.lastZone=o.zone;n.removeTag(o);o.zone=n.zones.find(function(e){return e.id==="zone-"+n.tagsZoneIndex});a()}};if(!this.readonly){o.draggable=new r(o.clone,{onDrag:i,onRelease:a,callbackScope:this}).disable()}this.addTag(o);var h=function(e){o.element.onmouseup=l;o.element.ontouchend=l;var t=n.getPosition(o.element);var i=n.outerContainerElement.getBoundingClientRect();n.outerContainerElement.appendChild(o.clone);o.clone.style.top=t.y-i.top+"px";o.clone.style.left=t.x-i.left+"px";n.setTweenLiteEffect(o.element,{autoAlpha:0,zIndex:r.zIndex+1});c.fromTo([o.element,o.clone],1,{scale:1},{scale:1.2},0);o.element.classList.add("shadowed");o.clone.classList.add("shadowed");n.setTweenLiteEffect(o.clone,{transform:"unset"});o.draggable.enable();o.draggable.update();o.draggable.startDrag(e)};if(!this.readonly){o.element.onmousedown=h;o.element.ontouchstart=h}return o};e.prototype.getUserAnswers=function(){var e=this;return this.zones.filter(function(t,n){return t.id!=="zone-"+e.tagsZoneIndex}).map(function(e){return e.tags}).filter(function(e){return e&&e.length&&e[0]}).map(function(e){return e[0].value})};e.prototype.setTweenLiteEffect=function(e,t){try{s.set(e,t)}catch(e){}};e.prototype.getOffset=function(e){var t=this.getPosition(e.clone);var n=this.getPosition(e.zone.element);return{x:t.x-n.x-e.element.offsetLeft,y:t.y-n.y-e.element.offsetTop}};e.prototype.hitTest=function(e,t,n){var o=n||e.threshold;return r.hitTest(t,e.parent,o)};e.prototype.isDropZoneFull=function(e){if(e.id==="zone-"+this.tagsZoneIndex){return false}return e.tags.length>=1};e.prototype.addTag=function(e){var t=e.zone.tags.indexOf(e);if(t<=-1&&!this.isDropZoneFull(e.zone)){e.zone.tags.push(e);e.zone.element.appendChild(e.element);this.updateTags(e.zone);this.updatePosition(e)}};e.prototype.removeTag=function(e){var t=e.zone.tags.indexOf(e);if(t>=0){e.zone.tags.splice(t,1);e.zone.element.removeChild(e.element);this.updateTags(e.zone)}};e.prototype.updateTags=function(e){if(e.sortProp){this.sortTags(e);e.tags.forEach(function(t){return e.element.appendChild(t.element)})}};e.prototype.updatePosition=function(e){e.x=e.element.offsetLeft;e.y=e.element.offsetTop;e.isGrid=e.zone.grid};e.prototype.getPosition=function(e){var t=e.getBoundingClientRect();var n=this.outerContainerElement.scrollLeft||0;var o=this.outerContainerElement.scrollTop||0;var i=this.outerContainerElement.clientLeft||0;var r=this.outerContainerElement.clientTop||0;return{x:t.left+n-i,y:t.top+o-r}};e.prototype.sortTags=function(e){e.tags.sort(function(t,n){var o=t[e.sortProp];var i=n[e.sortProp];if(o!==i){if(o>i||o===void 0){return 1}if(o<i||i===void 0){return-1}}return t["index"]-n["index"]})};e.prototype.getTagButtonColorClass=function(e){if(this.readonly&&this.checkArray(this.answer)&&this.checkArray(this.value)){var t=this.value.indexOf(e);var n=this.answer.indexOf(e);return this.answer.includes(e)&&t===n?"success":"danger"}return"danger-light"};e.prototype.addTagButton=function(e,t){var n;if(t&&e&&e.element){var o=document.createElement("yoo-button");o.text=t;(n=o.classList).add.apply(n,["tag",this.getTagButtonColorClass(t)]);e.element.appendChild(o);return o}};e.prototype.checkArray=function(e){return e&&e.length&&Array.isArray(e)};e.prototype.createDropZones=function(){var e=this;if(!this.readonly){this.zoneElements=Array.from(this.outerContainerElement.querySelectorAll(".drop-zone"))}if(this.checkArray(this.annotations)&&this.imageContainerElement){this.annotations.forEach(function(t,n){if(t&&e.imageElement){var o=e.imageElement.clientWidth;var i=e.imageElement.clientHeight;var r=o*t.percent_x;var s=i*t.percent_y;var a=document.createElement("div");a.classList.add("drop-zone-container");a.style.position="absolute";a.style.left=r+"px";a.style.top=s+"px";var l=document.createElement("div");l.classList.add("drop-zone");l.id="zone-"+n;a.appendChild(l);e.imageContainerElement.appendChild(a);e.zoneElements.push(l)}})}};e.prototype.renderImageContainer=function(){var e=this;return o("div",{class:"image-container",ref:function(t){return e.imageContainerElement=t}},this.image&&o("yoo-img",{ref:function(t){return e.imageElement=t},src:this.image._downloadURL}))};e.prototype.renderDescriptionContainer=function(){if(this.readonly){return}return o("div",{class:"description-container"},a(this.placeholder))};e.prototype.renderTagsContainer=function(){if(this.readonly){return}var e=this.checkArray(this.annotations)&&"zone-"+this.tagsZoneIndex;return o("div",{class:"tags-container"},o("div",{id:e,class:"drop-zone"}))};e.prototype.render=function(){var e=this;return o(i,{class:Object.assign({},l())},o("div",{class:"outer-container",ref:function(t){return e.outerContainerElement=t}},this.renderImageContainer(),this.renderDescriptionContainer(),this.renderTagsContainer()))};Object.defineProperty(e,"watchers",{get:function(){return{required:["requiredWatch"]}},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return".iframe-root{top:0;right:0;bottom:0;left:0;position:absolute;color:var(--black);overflow-y:auto;scrollbar-width:none}.iframe-root yoo-app .wrapper{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;height:100%;width:100%}.iframe-root yoo-app .wrapper.center-center{-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%}.iframe-root::-webkit-scrollbar{display:none}:host .outer-container{position:relative;margin:.5rem 0}:host .outer-container .image-container yoo-img{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;border-radius:var(--video-border,8px)}:host .outer-container .image-container .drop-zone{display:-ms-flexbox;display:flex;position:relative;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:20px;height:20px;border-radius:50%;background:var(--light,#fff);-webkit-box-shadow:var(--tile-shadow,0 5px 15px 3px rgba(40,47,54,.08));box-shadow:var(--tile-shadow,0 5px 15px 3px rgba(40,47,54,.08))}:host .outer-container .description-container{margin-top:1rem;color:var(--stable,#adadad);font-size:var(--font-size-03,1rem);letter-spacing:normal}:host .outer-container .tags-container{min-height:7rem;margin:1rem 0;white-space:nowrap;overflow-y:auto}:host .outer-container .tags-container .drop-zone{display:-ms-inline-flexbox;display:inline-flex;position:relative;-ms-flex-flow:row wrap;flex-flow:row wrap;height:100%}:host .outer-container .tags-container .drop-zone yoo-button{position:relative;margin:.25rem}:host .outer-container yoo-button{--transition:unset;display:block;z-index:2}:host .outer-container yoo-button.shadowed{--shadow:var(--form-slide-shadow,0 5px 10px 3px rgba(0,0,0,0.15))!important}:host .outer-container yoo-button.clone{position:absolute;top:0;left:0}"},enumerable:true,configurable:true});return e}())}}});