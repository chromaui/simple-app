import{r as t,c as s,h as i,H as h}from"./p-0d847530.js";import{b8 as e,b9 as r,t as o,ak as n,be as a,dj as c}from"./p-384bfcf6.js";import"./p-0f3d65ca.js";import"./p-8cff990b.js";import"./p-0d62bf9d.js";import"./p-d70b188c.js";import"./p-815d6c40.js";const d=class{constructor(i){t(this,i),this.placeholder="DRAGDROPTAGS",this.zoneElements=[],this.zones=[],this.zoneData=[],this.validityChanged=s(this,"validityChanged",7),this.inputBlurred=s(this,"inputBlurred",7),this.inputFocused=s(this,"inputFocused",7),this.inputChanged=s(this,"inputChanged",7),this.dragStarted=s(this,"dragStarted",7),this.dragEnded=s(this,"dragEnded",7)}requiredWatch(){this.validate()}componentWillLoad(){this.tagsZoneIndex=this.checkArray(this.annotations)&&this.annotations.length,this.zoneData=this.setConfigZones()}componentDidLoad(){this.outerContainerElement&&(this.setImageRatio(),this.createDropZones(),this.configureDropZones(),this.setTags())}componentDidUpdate(){this.checkArray(this.zoneElements)&&this.zoneElements.length===this.annotations.length+1||this.createDropZones()}validate(){if(this.checkArray(this.annotations))return this.validity=this.value.length===this.annotations.length,this.validityChanged.emit(this.validity),this.validity}setImageRatio(){if(this.imageElement){const t=2/3,s=this.outerContainerElement.clientWidth;this.imageContainerElement.style.height=`${s*t}px`,this.imageElement.style.height=`${s*t}px`}}configureDropZones(){this.zones=this.zoneData.map(t=>this.setDropZone(t))}setDropZone(t){if(this.checkArray(this.zoneElements))return t.element=this.zoneElements.find(s=>s.id===t.id),t.parent=t&&t.element&&t.element.parentNode,t}isTagsZone(t){return t===`zone-${this.tagsZoneIndex}`}setConfigZones(){if(this.annotations){const t=this.annotations.map((t,s)=>s);return t.push(this.tagsZoneIndex),t.map(t=>{let s={};return s.id=`zone-${t}`,s.threshold="60%",s.grid=this.isTagsZone(s.id),s.sortProp=this.isTagsZone(s.id)&&"value",s.tags=[],s})}}setTags(){this.checkArray(this.values)&&(this.checkArray(this.value)?(this.readonly||this.values.filter(t=>!this.value.includes(t)).sort().forEach(t=>this.setTag(t,this.tagsZoneIndex)),this.value.forEach((t,s)=>this.setTag(t,s))):this.values.sort().forEach(t=>this.setTag(t,this.tagsZoneIndex)))}configureTag(t,s){let i={x:0,y:0,left:0,top:0};return i.value=t,i.zone=this.zoneData.find(t=>t.id===`zone-${s}`),i.element=this.addTagButton(i.zone,t),i.zone.element=i.element.parentElement,i.clone=i.element.cloneNode(!0),i.clone.text=i.value,i.clone.classList.add("clone"),i.lastZone=i.zone,i}setTag(t,s){let i=this.configureTag(t,s);this.setTweenLiteEffect([i.element,i.clone],{x:"+=0"});const h=()=>{i.draggable.disable(),a.fromTo([i.element,i.clone],1,{scale:1.2},{scale:1},0),i.element.classList.remove("shadowed"),i.clone.classList.remove("shadowed"),this.setTweenLiteEffect(i.element,{left:0,top:0});let t=this.zones.every(t=>!this.hitTest(t,i.clone));i.zone||(i.zone=i.lastZone,this.zones.forEach(t=>{this.hitTest(t,i.clone)&&!this.isDropZoneFull(t)&&(i.zone=t)})),this.addTag(i);let s=this.getOffset(i),h={onComplete:()=>{i.clone&&this.outerContainerElement.removeChild(i.clone),this.setTweenLiteEffect(i.element,{autoAlpha:1})}};if(t&&!i.isGrid)h.x="-="+s.x,h.y="-="+s.y;else if(i.isGrid)this.setTweenLiteEffect(i.element,{left:0,top:0}),h.x="-="+s.x,h.y="-="+s.y;else{let t=i.zone.element.getBoundingClientRect();i.left=`${s.x/t.width*100}%`,i.top=`${s.y/t.height*100}%`,this.setTweenLiteEffect(i.element,{left:i.left,top:i.top})}r.to(i.clone,.3,h),this.value=this.getUserAnswers(),c(this.value,this),this.dragEnded.emit(!0)},o=()=>{i.zone&&i.zone.id!==`zone-${this.tagsZoneIndex}`&&(i.lastZone=i.zone,this.removeTag(i),i.zone=this.zones.find(t=>t.id===`zone-${this.tagsZoneIndex}`),h())};this.readonly||(i.draggable=new e(i.clone,{onDrag:()=>{this.dragStarted.emit(!0),i.zone&&!this.hitTest(i.zone,i.clone,0)&&(i.lastZone=i.zone,this.removeTag(i),i.zone=null)},onRelease:h,callbackScope:this}).disable()),this.addTag(i);const n=t=>{i.element.onmouseup=o,i.element.ontouchend=o;let s=this.getPosition(i.element),h=this.outerContainerElement.getBoundingClientRect();this.outerContainerElement.appendChild(i.clone),i.clone.style.top=`${s.y-h.top}px`,i.clone.style.left=`${s.x-h.left}px`,this.setTweenLiteEffect(i.element,{autoAlpha:0,zIndex:e.zIndex+1}),a.fromTo([i.element,i.clone],1,{scale:1},{scale:1.2},0),i.element.classList.add("shadowed"),i.clone.classList.add("shadowed"),this.setTweenLiteEffect(i.clone,{transform:"unset"}),i.draggable.enable(),i.draggable.update(),i.draggable.startDrag(t)};return this.readonly||(i.element.onmousedown=n,i.element.ontouchstart=n),i}getUserAnswers(){return this.zones.filter(t=>t.id!==`zone-${this.tagsZoneIndex}`).map(t=>t.tags).filter(t=>t&&t.length&&t[0]).map(t=>t[0].value)}setTweenLiteEffect(t,s){try{r.set(t,s)}catch(t){}}getOffset(t){let s=this.getPosition(t.clone),i=this.getPosition(t.zone.element);return{x:s.x-i.x-t.element.offsetLeft,y:s.y-i.y-t.element.offsetTop}}hitTest(t,s,i){return e.hitTest(s,t.parent,i||t.threshold)}isDropZoneFull(t){return t.id!==`zone-${this.tagsZoneIndex}`&&t.tags.length>=1}addTag(t){t.zone.tags.indexOf(t)<=-1&&!this.isDropZoneFull(t.zone)&&(t.zone.tags.push(t),t.zone.element.appendChild(t.element),this.updateTags(t.zone),this.updatePosition(t))}removeTag(t){let s=t.zone.tags.indexOf(t);s>=0&&(t.zone.tags.splice(s,1),t.zone.element.removeChild(t.element),this.updateTags(t.zone))}updateTags(t){t.sortProp&&(this.sortTags(t),t.tags.forEach(s=>t.element.appendChild(s.element)))}updatePosition(t){t.x=t.element.offsetLeft,t.y=t.element.offsetTop,t.isGrid=t.zone.grid}getPosition(t){const s=t.getBoundingClientRect();return{x:s.left+(this.outerContainerElement.scrollLeft||0)-(this.outerContainerElement.clientLeft||0),y:s.top+(this.outerContainerElement.scrollTop||0)-(this.outerContainerElement.clientTop||0)}}sortTags(t){t.tags.sort((s,i)=>{let h=s[t.sortProp],e=i[t.sortProp];if(h!==e){if(h>e||void 0===h)return 1;if(h<e||void 0===e)return-1}return s.index-i.index})}getTagButtonColorClass(t){if(this.readonly&&this.checkArray(this.answer)&&this.checkArray(this.value)){const s=this.value.indexOf(t),i=this.answer.indexOf(t);return this.answer.includes(t)&&s===i?"success":"danger"}return"danger-light"}addTagButton(t,s){if(s&&t&&t.element){const i=document.createElement("yoo-button");return i.text=s,i.classList.add("tag",this.getTagButtonColorClass(s)),t.element.appendChild(i),i}}checkArray(t){return t&&t.length&&Array.isArray(t)}createDropZones(){this.readonly||(this.zoneElements=Array.from(this.outerContainerElement.querySelectorAll(".drop-zone"))),this.checkArray(this.annotations)&&this.imageContainerElement&&this.annotations.forEach((t,s)=>{if(t&&this.imageElement){const i=this.imageElement.clientWidth*t.percent_x,h=this.imageElement.clientHeight*t.percent_y,e=document.createElement("div");e.classList.add("drop-zone-container"),e.style.position="absolute",e.style.left=`${i}px`,e.style.top=`${h}px`;const r=document.createElement("div");r.classList.add("drop-zone"),r.id=`zone-${s}`,e.appendChild(r),this.imageContainerElement.appendChild(e),this.zoneElements.push(r)}})}renderImageContainer(){return i("div",{class:"image-container",ref:t=>this.imageContainerElement=t},this.image&&i("yoo-img",{ref:t=>this.imageElement=t,src:this.image._downloadURL}))}renderDescriptionContainer(){if(!this.readonly)return i("div",{class:"description-container"},o(this.placeholder))}renderTagsContainer(){if(this.readonly)return;const t=this.checkArray(this.annotations)&&`zone-${this.tagsZoneIndex}`;return i("div",{class:"tags-container"},i("div",{id:t,class:"drop-zone"}))}render(){return i(h,{class:Object.assign({},n())},i("div",{class:"outer-container",ref:t=>this.outerContainerElement=t},this.renderImageContainer(),this.renderDescriptionContainer(),this.renderTagsContainer()))}static get watchers(){return{required:["requiredWatch"]}}static get style(){return".iframe-root{top:0;right:0;bottom:0;left:0;position:absolute;color:var(--black);overflow-y:auto;scrollbar-width:none}.iframe-root yoo-app .wrapper{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;height:100%;width:100%}.iframe-root yoo-app .wrapper.center-center{-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%}.iframe-root::-webkit-scrollbar{display:none}:host .outer-container{position:relative;margin:.5rem 0}:host .outer-container .image-container yoo-img{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;border-radius:var(--video-border,8px)}:host .outer-container .image-container .drop-zone{display:-ms-flexbox;display:flex;position:relative;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:20px;height:20px;border-radius:50%;background:var(--light,#fff);-webkit-box-shadow:var(--tile-shadow,0 5px 15px 3px rgba(40,47,54,.08));box-shadow:var(--tile-shadow,0 5px 15px 3px rgba(40,47,54,.08))}:host .outer-container .description-container{margin-top:1rem;color:var(--stable,#adadad);font-size:var(--font-size-03,1rem);letter-spacing:normal}:host .outer-container .tags-container{min-height:7rem;margin:1rem 0;white-space:nowrap;overflow-y:auto}:host .outer-container .tags-container .drop-zone{display:-ms-inline-flexbox;display:inline-flex;position:relative;-ms-flex-flow:row wrap;flex-flow:row wrap;height:100%}:host .outer-container .tags-container .drop-zone yoo-button{position:relative;margin:.25rem}:host .outer-container yoo-button{--transition:unset;display:block;z-index:2}:host .outer-container yoo-button.shadowed{--shadow:var(--form-slide-shadow,0 5px 10px 3px rgba(0,0,0,0.15))!important}:host .outer-container yoo-button.clone{position:absolute;top:0;left:0}"}};export{d as yoo_form_image_tagging};