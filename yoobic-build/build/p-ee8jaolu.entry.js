import{r as t,c as i,h as s,g as e}from"./p-0d847530.js";import{d5 as l,B as h,t as o,u as r,W as a,fZ as n,fX as d,dj as c,al as u}from"./p-384bfcf6.js";import"./p-0f3d65ca.js";import"./p-8cff990b.js";import"./p-0d62bf9d.js";import{dd as p}from"./p-d70b188c.js";import"./p-815d6c40.js";const f=class{constructor(s){t(this,s),this.validators=[],this.isHistory=!1,this.validityChanged=i(this,"validityChanged",7),this.inputBlurred=i(this,"inputBlurred",7),this.inputFocused=i(this,"inputFocused",7),this.inputChanged=i(this,"inputChanged",7),this.fetchData=i(this,"fetchData",7),this.fetchFieldFilterData=i(this,"fetchFieldFilterData",7)}async updateValues(t){this.formAutocomplete&&this.formAutocomplete.updateValues(t)}componentWillLoad(){l(this)}onSelect(t){t.stopPropagation(),t.detail&&(this.isCheck?this.setValue(t.detail):this.addProducts(t.detail))}get selectedProducts(){if(this.isCheck)return[].concat(this.value);{let t=[];return this.getProductRefs().forEach(i=>{this.products.forEach(s=>{s._id===i&&this.value[i]>0&&t.push(s)})}),t}}onFetchData(t){t.stopPropagation(),this.fetchData.emit(t.detail)}onFetchFieldFilterData(t){t.stopPropagation(),this.catalog&&t.detail&&t.detail.field&&(t.detail.field.filters=[[{field:"catalogRef",operator:{_id:"eq"},value:this.catalog}]]),this.fetchFieldFilterData.emit(t.detail)}onScanned(t){t.stopPropagation(),this.notFoundError="";let i=t.detail;if(i){let t=h(this.products,t=>t.reference===i);if(t&&t.length>0){let i=t[0];this.isCheck&&this.setValue(i),this.addProducts([i])}else this.notFoundError=i+" "+o("NOTFOUND")}}onInputBlurred(t){t.stopPropagation(),this.inputBlurred.emit(t.detail)}onInputFocused(t){t.stopPropagation(),this.inputFocused.emit(t.detail)}addProducts(t){t&&t.length>0&&t.forEach(t=>this.addProduct(t))}setProduct(t,i){if(0===i||!r(i)||i<0)return;if(t.outofstock)return;let s=this.value||{};a(this.value)||(this.value={}),s[t._id]=s[t._id]||0,s[t._id]=this.isPresence?1:i>0?i:0,this.products&&this.products.findIndex(i=>i._id===t._id)<0&&this.products.push(t),this.setValue(s)}addProduct(t){if(t.outofstock)return;let i=this.value||{};a(this.value)||(this.value={}),i[t._id]=i[t._id]||0,this.isPresence?i[t._id]=1:i[t._id]+=t.step-0||1,this.products&&this.products.findIndex(i=>i._id===t._id)<0&&this.products.push(t),this.setValue(i)}removeProduct(t){if(t.outofstock)return;let i=this.value||{};i[t._id]=i[t._id]||0,i[t._id]-=t.step-0||1,i[t._id]<=0&&(i[t._id]=0),this.setValue(i)}clearProduct(t){let i=this.value||{};i[t._id]=0,this.setValue(i)}getProductRefs(){return n(d(this.value||{}),["price","total"])}getTotalAndPrice(){let t=this.getProductRefs(),i=0,s=0;return t.forEach(t=>{let e=this.value[t];if(e>0&&(i+=e),this.products){let i=this.products.find(i=>i._id===t);e>0&&i&&i.price>0&&(s+=e*i.price)}}),{total:i,price:s}}setValue(t){let i=this.getTotalAndPrice();(t=t||{}).price=i.price,t.total=i.total,c(t,this)}onOpenCatalogDialog(t){this.dialog=document.createElement("yoo-form-catalog-dialog"),this.dialog.product=t,u(this.dialog,{half:!1},null,"slideXEnterAnimation","slideXLeaveAnimation",!0).then(()=>{this.dialog=null})}renderProducts(t){if(t&&this.isCheck)return s("yoo-entity",{class:"simple no-border",displayType:"card-list",entityType:"products",item:this.value});let i=this.getTotalAndPrice();return i.total>0?s("div",{class:"products"},s("div",{class:"title"}," ",o("PRODUCTS")),s("div",{class:"subtitle"}," ",i.total+" "+o("ITEMS")),this.renderInnerProducts(t),this.isInventory||this.isPresence||this.isCheck?null:s("div",{class:"footer"},s("div",{class:"title"},o("TOTAL"),":"),s("div",{class:"price"},p.currency.transform(i.price)))):null}renderInnerProducts(t){if(this.products&&this.products.length>0)return this.getProductRefs().map(i=>{let e=this.value[i],l=this.products.find(t=>t._id===i);if(e>0&&l){let i=l.price*e;return[s("div",{class:"entity"},s("yoo-entity",{onClick:()=>this.onOpenCatalogDialog(l),class:"catalog-display",isHistory:this.isHistory,displayType:"card-list",entityType:"products",item:l}),t?null:s("div",{class:"remove",onClick:()=>this.clearProduct(l)}," ",s("yoo-icon",{class:"yo-cross"})," ")),this.isPresence?null:s("div",{class:{toolbar:!0,history:this.isHistory}},s("div",{class:"title"},o("QUANTITY"),": "),t?null:s("div",{class:"icon right",onClick:()=>this.removeProduct(l)}," ","-"," "),s("div",{class:"quantity"},t?e:s("yoo-form-input",{value:e,hasIconPrefix:!1,clearable:!1,forceValueUpdate:!0,onInputChanged:t=>{t.stopPropagation(),this.setProduct(l,t.detail)},type:"number"}),this.isHistory&&!this.isInventory&&i>0?s("span",null,"x"):null),t?null:s("div",{class:"icon left",onClick:()=>this.addProduct(l)}," ","+"," "),!this.isInventory&&i>0?s("div",{class:"price"},p.currency.transform(i)," "):null)]}})}onAutoCompleteValidityChanged(t){t.stopPropagation()}renderEditable(){return s("div",{class:"outer-container"},s("yoo-form-autocomplete",{ref:t=>this.formAutocomplete=t,multiple:!this.isCheck,value:this.selectedProducts,entityType:"products",displayType:"card-list",iconPrefix:"yo-catalogue",onFetchData:t=>this.onFetchData(t),onFetchFieldFilterData:t=>this.onFetchFieldFilterData(t),onInputChanged:t=>this.onSelect(t),onInputBlurred:t=>this.onInputBlurred(t),onInputFocused:t=>this.onInputFocused(t),onValidityChanged:t=>this.onAutoCompleteValidityChanged(t),placeholder:o("ADDPRODUCTTOBASKET"),hideSelectionFromInput:!this.isCheck,tags:this.tags,isLocal:!1,model:this.model,inputTabIndex:this.inputTabIndex}),s("div",{class:"or"},o("OR")),s("yoo-form-barcode",{onInputChanged:t=>this.onScanned(t),placeholder:o("SCANPRODUCTTOBASKET"),hideValue:!0}),this.notFoundError?s("div",{class:"error",innerHTML:this.notFoundError}):null,this.isCheck?null:this.renderProducts(!1))}renderHistory(){return s("yoo-ion-scroll",{class:"relative"},this.renderReadonly())}renderReadonly(){return s("div",{class:"readonly"},this.renderProducts(!0))}render(){return this.isHistory?this.renderHistory():this.readonly?this.renderReadonly():this.renderEditable()}get host(){return e(this)}static get style(){return".iframe-root{top:0;right:0;bottom:0;left:0;position:absolute;color:var(--black);overflow-y:auto;scrollbar-width:none}.iframe-root yoo-app .wrapper{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;height:100%;width:100%}.iframe-root yoo-app .wrapper.center-center{-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%}.iframe-root::-webkit-scrollbar{display:none}:host .outer-container,:host .readonly{padding:.5rem;padding-left:0;padding-bottom:0}:host .outer-container .or,:host .readonly .or{padding:.5rem;color:var(--text-color,#807f83);font-size:var(--font-size-02,.875rem);text-align:center}:host .outer-container .selected,:host .readonly .selected{background-color:var(--light,#fff)}:host .outer-container .error,:host .readonly .error{color:var(--danger,#ff625f)}:host .outer-container .products>.title,:host .readonly .products>.title{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;margin-top:.5rem;color:var(--black,#000);font-size:var(--font-size-03,1rem);font-weight:var(--font-weight-01,300);line-height:1.5;text-align:left;text-transform:uppercase}:host .outer-container .products .subtitle,:host .readonly .products .subtitle{margin-top:.125rem;color:var(--text-color,#807f83);font-size:var(--font-size-01,.75rem)}:host .outer-container .products .remove,:host .readonly .products .remove{display:-ms-flexbox;display:flex;-ms-flex-line-pack:center;align-content:center;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;min-width:40px;text-align:center}:host .outer-container .products .entity,:host .readonly .products .entity{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row}:host .outer-container .products .toolbar,:host .readonly .products .toolbar{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;padding:.5rem;border-top:1px solid var(--stable-light,#f1f1f1);border-bottom:1px solid var(--stable-light,#f1f1f1);font-size:var(--font-size-03,1rem)}:host .outer-container .products .toolbar.history,:host .readonly .products .toolbar.history{font-size:var(--font-size-02,.875rem)}:host .outer-container .products .toolbar .title,:host .readonly .products .toolbar .title{-ms-flex:1;flex:1;padding:3px .5rem 3px 0;color:var(--black,#000);font-size:var(--font-size-01,.75rem)}:host .outer-container .products .toolbar .title.align-right,:host .readonly .products .toolbar .title.align-right{text-align:right}:host .outer-container .products .toolbar .quantity,:host .readonly .products .toolbar .quantity{padding:0 .5rem;color:var(--black,#000);text-align:center}:host .outer-container .products .toolbar .quantity yoo-form-input,:host .readonly .products .toolbar .quantity yoo-form-input{width:100px}:host .outer-container .products .toolbar .price,:host .readonly .products .toolbar .price{-ms-flex:1;flex:1;padding-left:.5rem;color:var(--black,#000);text-align:right;white-space:nowrap}:host .outer-container .products .toolbar .icon,:host .readonly .products .toolbar .icon{width:22px;min-width:22px;height:22px;min-height:22px;border-radius:50%;background:var(--stable-light,#f1f1f1);text-align:center}:host .outer-container .products .footer,:host .readonly .products .footer{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:.5rem;padding-top:1rem;padding-bottom:.5rem;color:var(--black,#000)}:host .outer-container .products .footer .title,:host .readonly .products .footer .title{-ms-flex:1;flex:1;text-transform:uppercase}:host .outer-container .products .footer .price,:host .readonly .products .footer .price{text-align:right}:host(.history) .readonly{max-width:800px}"}};export{f as yoo_form_catalog};