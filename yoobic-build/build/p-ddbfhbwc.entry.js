import{r as t,c as s,h as e,g as i}from"./p-0d847530.js";import{d5 as r,W as a,dj as c,al as l,fX as d,t as o,Y as n,cE as h}from"./p-384bfcf6.js";import"./p-0f3d65ca.js";import"./p-8cff990b.js";import"./p-0d62bf9d.js";import"./p-d70b188c.js";import"./p-815d6c40.js";const u=class{constructor(e){t(this,e),this.validators=[],this.isHistory=!1,this.validityChanged=s(this,"validityChanged",7),this.inputBlurred=s(this,"inputBlurred",7),this.inputFocused=s(this,"inputFocused",7),this.inputChanged=s(this,"inputChanged",7)}requiredWatch(){this.validate()}componentWillLoad(){r(this)}validate(){let t=!0;return this.required&&!this.value&&(t=!1),this.validity&&this.validity===t||(this.validityChanged.emit(t),this.validity=t),this.validity}addProduct(t,s){let e=this.value||{};a(this.value)||(this.value={}),e[t._id]=s,c(e,this)}clearProduct(t){let s=this.value||{};delete s[t._id],this.setValue(s)}setValue(t){c(t=t||{},this)}getDelta(t,s){let e=0;return t>0&&s>0&&(e=Math.round((s-t)/t*100)),e}onOpenScanner(){let t,s=document.createElement("yoo-form-barcode-dialog");s.mainMode="default",s.priceCheckMode=!0,s.heading="SCANABARCODE";let e=e=>{if("default"===s.mainMode)(t=this.products.find(t=>t.reference===e.detail))?(s.restartScannerByMode("ocr"),s.product=t,s.heading="SCANAPRICE"):(s.restartScannerByMode("default"),s.scannerHeading='<h2 class="danger">'+o("INVALIDPRODUCTSCANNED")+"</h2>");else{let i=document.createElement("yoo-form-dynamic-dialog"),r=e.detail-0,a=this.getDelta(t.price,r);i.data={product:t,price:r,delta:a,deltaDisplay:`<div class="${a>0?"success":"danger"}" >${a} %</div>`},i.header=t.title,i.slides=[{title:"GENERAL",items:[{name:"product",readonly:!0,type:n.catalog,check:!0},{name:"price",readonly:!0,type:n.number,title:o("PRICE2")},{name:"deltaDisplay",readonly:!0,visible:0!==a,title:"Delta",type:n.text}]}],i.showTabs=!1,i.showRecap=!1,i.hideSaveButton=!0,i.footerButtons=[{text:()=>o("NEXTPRODUCT"),cssClass:()=>"light",handler:(t,e)=>{this.addProduct(t.product,t.price),s.restartScannerByMode("default"),s.product=null,s.heading="SCANABARCODE",e&&e.onCancel&&e.onCancel(!0)}},{text:()=>o("SAVE"),cssClass:()=>"success",handler:(t,s)=>{this.addProduct(t.product,t.price),s&&s.onCancel&&s.onCancel()}}],l(i).then(t=>{t.data||setTimeout(()=>h(!0),300)})}};s.addEventListener("scannedSuccess",e),l(s).then(()=>{s&&(s.removeEventListener("scannedSuccess",e),s=null)})}getProductRefs(){return d(this.value||{})}renderInnerProducts(t){if(this.products&&this.products.length>0)return this.getProductRefs().map(s=>{let i=this.value[s],r=this.products.find(t=>t._id===s);if(r){let s=this.getDelta(r.price,i);return[e("div",{class:"entity"},e("yoo-entity",{class:"catalog-display simple",displayType:"card-list",entityType:"products",item:r}),t?null:e("div",{class:"remove",onClick:()=>this.clearProduct(r)}," ",e("yoo-icon",{class:"yo-cross"})," ")),e("div",{class:{toolbar:!0,history:this.isHistory}},e("div",{class:"price"},i.toLocaleString()," "),e("div",{class:"delta "+(s>0?"success":"danger")},s.toLocaleString()+" %"," "))]}})}renderReadonly(){return e("div",{class:"readonly"},e("div",{class:"products"}," ",this.renderInnerProducts(!0)))}renderEditable(){return e("div",{class:"outer-container"},e("div",{class:"barcode-container",onClick:()=>this.onOpenScanner()},e("yoo-icon",{class:"center yo-barcode success"})),e("div",{class:"products"},this.renderInnerProducts(!1)))}render(){return this.readonly?this.renderReadonly():this.renderEditable()}get host(){return i(this)}static get watchers(){return{required:["requiredWatch"]}}static get style(){return".iframe-root{top:0;right:0;bottom:0;left:0;position:absolute;color:var(--black);overflow-y:auto;scrollbar-width:none}.iframe-root yoo-app .wrapper{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;height:100%;width:100%}.iframe-root yoo-app .wrapper.center-center{-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:100%}.iframe-root::-webkit-scrollbar{display:none}:host .outer-container .barcode-container,:host .readonly .barcode-container{display:-ms-flexbox;display:flex;position:relative;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;width:98px;height:98px;border:1px solid var(--input-container-border-color,hsla(0,0%,67.8%,.4));border-radius:.5rem;cursor:pointer}:host .outer-container .barcode-container .required,:host .readonly .barcode-container .required{top:auto;right:auto;bottom:auto;left:.625rem;position:absolute;color:var(--success,#04cc99);font-size:var(--font-size-03,1rem)}:host .outer-container .barcode-container yoo-icon,:host .readonly .barcode-container yoo-icon{font-size:var(--font-size-09,2.25rem)}:host .outer-container .products>.title,:host .readonly .products>.title{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;margin-top:.5rem;color:var(--black,#000);font-size:var(--font-size-03,1rem);font-weight:var(--font-weight-01,300);line-height:1.5;text-align:left;text-transform:uppercase}:host .outer-container .products .subtitle,:host .readonly .products .subtitle{margin-top:.125rem;color:var(--text-color,#807f83);font-size:var(--font-size-01,.75rem)}:host .outer-container .products .remove,:host .readonly .products .remove{display:-ms-flexbox;display:flex;-ms-flex-line-pack:center;align-content:center;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;min-width:40px;text-align:center}:host .outer-container .products .entity,:host .readonly .products .entity{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row}:host .outer-container .products .toolbar,:host .readonly .products .toolbar{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;margin-top:-2.1rem;padding:.5rem;border-bottom:1px solid var(--stable-light,#f1f1f1);font-size:var(--font-size-02,.875rem);z-index:2}:host .outer-container .products .toolbar.history,:host .readonly .products .toolbar.history{font-size:var(--font-size-02,.875rem)}:host .outer-container .products .toolbar .price,:host .readonly .products .toolbar .price{-ms-flex:1;flex:1;padding-left:.5rem;padding-left:4.2rem;color:var(--black,#000);white-space:nowrap}:host .outer-container .products .toolbar .delta,:host .readonly .products .toolbar .delta{margin-left:1rem}:host .outer-container .products .toolbar .delta.success,:host .readonly .products .toolbar .delta.success{color:var(--success,#04cc99)}:host .outer-container .products .toolbar .delta.danger,:host .readonly .products .toolbar .delta.danger{color:var(--danger,#ff625f)}:host .outer-container .products .toolbar .icon,:host .readonly .products .toolbar .icon{width:22px;min-width:22px;height:22px;min-height:22px;border-radius:50%;background:var(--stable-light,#f1f1f1);text-align:center}:host .outer-container .products .footer,:host .readonly .products .footer{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:.5rem;padding-top:1rem;padding-bottom:.5rem;color:var(--black,#000)}:host .outer-container .products .footer .title,:host .readonly .products .footer .title{-ms-flex:1;flex:1;text-transform:uppercase}:host .outer-container .products .footer .price,:host .readonly .products .footer .price{text-align:right}:host .readonly{padding:.5rem;padding-left:0;padding-bottom:0}:host(.history){margin:0!important;border:0!important}:host(.history),:host(.history) .readonly{padding:0!important}"}};export{u as yoo_form_pricecheck};